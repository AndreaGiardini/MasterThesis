\section{Monitoring}

The computing infrastructure is monitored by a custom monitoring system
which became more and more important in the last years due to the growing
number of machines. The servers report their status to a central
monitoring instance, which stores metrics and statistics for all the
machines. The system provides a set of default metrics for CPU, memory and
storage but the user is also able to define custom sensors to monitor
their services. Service managers are able to create custom dashboards and
graphs based on those metrics.

The previous monitoring system, based entirely on Lemon, has been
partially replaced to use new technologies like Elasticsearch, Kibana and
Flume. 

\subsection{Elasticsearch}

Elasticsearch is a search engine based on Apache Lucene. It is developed
in Java and it provides a full-text search engine with a RESTFul web
interface and schema-free JSON documents. Indices can be divided into
shards and every shard can have one or more replicas; each node hosts one
or more shards and a coordinator redirects the query operations to the
correct one. Moreover Elasticsearch provides some functionalities for
rebalancing and routing: even if one or more node goes down it is able to
reroute the requests to the replica shard and, at the same time, find
a strategy to rebalance the pool copying indexes between different
hosts.

In the last years Elasticsearch has become more and more popular in the
opensource world becoming in 2015 the second most popular search engine
after Apache Solr.

\subsection{Kibana}

Kibana is a open-source tool to visualize and graph the information
stored in a Elasticsearch database. It allows the user to organize the
documents in a graphical way using custom graphs and dashboards.

We used Kibana extensively to graph and monitor the performance for the
most of our clusters. In particular we found it really useful whenever we
had incidents in our services: correlating metrics and graphs in the right
way makes possible to highlight when the incident started and how it
escalated. Finding the causes of the incidents got easier as well, since
using graphs plotting different metrics it is easier to correlate
different aspects of the same cluster.

\subsection{Flume}

Flume is a distributed and reliable service for collecting and aggregating
large amounts of data. It processes and organizes the metrics sent by
lemon before sending them to Elasticsearch. Moreover it provides an
additional layer of redundancy: if the central Elasticsearch instance is
not available or under maintenance, Flume can store metrics up to 24
hours, in order not to lose data in case of downtime.

Flume is also capable of reprocessing the log entries to make them
compatible with the defined metric schema.
