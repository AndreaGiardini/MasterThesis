\section{Configuration Change Process}

Since the deployment of the puppet infrastructure it was clear that a precise
and well defined strategy for code changes was needed. Since shared modules are
used my multiple service managers for different type of use cases, every time
a module needs to be changed we need to be sure that it won't break any
service.

For this reason we have a defined procedure to modify shared modules:

\begin{itemize}

\item Branch the module to be modified

The first thing to do it clone the module repository, create a custom branch
and apply the changes that we would like to include in production. In this way
the change can be reviewed and tested before being merged to qa or master.

\item Build a test machine using a custom environment

Create a custom environment including the custom branch just created and spawn
a new machine; check puppet reports for error and make sure that the change is
doing what you expect.

\item Open a CRM (Config Release Management) ticket

Jira is used to keep track of all the module changes and to announce that
change to all the service managers using that module. A new ticket includes the
reason for that change and the custom branch that contains it: Jenkins uses
those paramenters to trigger a series of automated tests

\item Change is merged to QA

After Jenkins runs all the tests, if all of them are successful, it
automatically merges the custom branch into qa, deploying the change in all the
testing machines. At this point service managers have one week to test the
change and make sure that everything is ok.

If the change breaks their systems they can block it using Jira and ask the
user to fix the problem before deploying it or the ticket will be rejected.

\item Change is merged to master

If after one week there are no complaints the change is merged from the custom
branch to master and it's deployed in all the production machines; the CRM
ticket is closed.

\end{itemize}

In exceptional circumstances a workflow for emergency changes is defined in
case of urgent security issues: the user is allowed to skip the traditional CRM
process and merge his change directly to master. It has to be said that
emergency changes should be agreed by the group responsible for the module and
will be reviewed with the involved service managers at next meeting.

